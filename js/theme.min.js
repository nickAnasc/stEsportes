function magnify(imgID, zoom) {
    var img, glass, w, h, bw;
    var newElement = document.querySelector('.img-magnifier-glass');
    img = document.querySelector(imgID);

    if (!newElement) {
        /* Create magnifier glass: */
        glass = document.createElement("DIV");
        glass.setAttribute("class", "img-magnifier-glass");
    } else {
        newElement.remove();
        glass = document.createElement("DIV");
        glass.setAttribute("class", "img-magnifier-glass");
    }

    /* Insert magnifier glass: */
    if (img) {
        img.parentElement.insertBefore(glass, img);
        /* Set background properties for the magnifier glass: */
        glass.style.backgroundImage = "url('" + img.src + "')";
        glass.style.backgroundRepeat = "no-repeat";
        glass.style.backgroundSize = (img.width * zoom) + "px " + (img.height * zoom) + "px";
        bw = 3;
        w = glass.offsetWidth / 2;
        h = glass.offsetHeight / 2;

        /* Execute a function when someone moves the magnifier glass over the image: */
        glass.addEventListener("mousemove", moveMagnifier);
        img.addEventListener("mousemove", moveMagnifier);

        /*and also for touch screens:*/
        glass.addEventListener("touchmove", moveMagnifier);
        img.addEventListener("touchmove", moveMagnifier);

        function moveMagnifier(e) {
            var pos, x, y;
            /* Prevent any other actions that may occur when moving over the image */
            e.preventDefault();
            /* Get the cursor's x and y positions: */
            pos = getCursorPos(e);
            x = pos.x;
            y = pos.y;
            /* Prevent the magnifier glass from being positioned outside the image: */
            if (x > img.width - (w / zoom)) { x = img.width - (w / zoom); }
            if (x < w / zoom) { x = w / zoom; }
            if (y > img.height - (h / zoom)) { y = img.height - (h / zoom); }
            if (y < h / zoom) { y = h / zoom; }
            /* Set the position of the magnifier glass: */
            glass.style.left = (x - w) + "px";
            glass.style.top = (y - h) + "px";
            /* Display what the magnifier glass "sees": */
            glass.style.backgroundPosition = "-" + ((x * zoom) - w + bw) + "px -" + ((y * zoom) - h + bw) + "px";
        }

        function getCursorPos(e) {
            var a, x = 0,
                y = 0;
            e = e || window.event;
            /* Get the x and y positions of the image: */
            a = img.getBoundingClientRect();
            /* Calculate the cursor's x and y coordinates, relative to the image: */
            x = e.pageX - a.left;
            y = e.pageY - a.top;
            /* Consider any page scrolling: */
            x = x - window.pageXOffset;
            y = y - window.pageYOffset;
            return { x: x, y: y };
        }
    }
}

(function ($) {

    $(document).ready(function () {

        document.getElementById("news-name").required;
        document.getElementById("news-email").required;

        // cart support class
        if ($('.caixa-cupom').length) {
            $('.caixa-cupom').parents('tr').addClass('cupom-wrapper');
        }

        if ($('#calculoFrete').length) {
            $('#calculoFrete').parents('tr').addClass('frete-wrapper');
        }

        // start slick on banner home
        if ($.fn.jquery != '1.6.2') {
            $('.banner-full .slick').slick({
                dots: true,
                arrows: false,
                slidesToShow: 1,
                slidesToScroll: 1,

                responsive: [{
                    breakpoint: 768,

                }]
            });
        }

    });

    // 	gifts list fix
    if ($(".page-lista, .page-print_lista").length) {
        $(".lista-produtos").wrapAll("<div class='wrap-gifts'></div>");
    }

    $("img.lazy").lazyload({
        threshold: 200
    });

})(jQuery);

// menu mobile
(function () {
    var btnMenu = document.getElementsByClassName('trigger-menu')[0];
    var btnClose = document.getElementsByClassName('close-menu')[0];
    var html = document.getElementsByTagName('html')[0];
    var backdropMobile = document.getElementsByClassName('menu-mobile-backdrop')[0];

    btnMenu.addEventListener('click', function () {
        html.classList.add('menu-open');
    });

    btnClose.addEventListener('click', function () {
        html.classList.remove('menu-open');
    });
})();

// SLIDE GALLERY PRODUCT
(function slideGallery() {
    var contentPhoto = document.querySelector('.main-photo-content')

    if (contentPhoto) {
        //SLIDE GALLERY CARROSSEL
        jQuery('.photo-carrossel').slick({
            infinite: true,
            slidesToShow: 4,
            slidesToScroll: 1,
            dots: false,
            arrows: true,
            adaptiveHeight: true,
            responsive: [{
                breakpoint: 992,
                settings: {
                    slidesToShow: 3
                }
            },
            {
                breakpoint: 480,
                settings: {
                    slidesToShow: 2
                }
            },
            ]
        });

        setTimeout(function () {
            var photos = document.querySelectorAll('.change-photo');

            photos.forEach(photo => {
                photo.addEventListener('click', function () {
                    var changeUrl = this.getAttribute('data-full')
                    contentPhoto.setAttribute('src', changeUrl)
                })
            });

        }, 1000);
    }
})();

(function zoomImage() {
    magnify(".main-photo-content", 1.4);

    setTimeout(function () {
        var photos = document.querySelectorAll('.change-photo.slick-slide');
        photos.forEach(photo => {
            photo.addEventListener('click', function () {
                var zoom = document.querySelector('.img-magnifier-glass');
                if (zoom) {
                    document.querySelector('.img-magnifier-glass').remove();
                }
                magnify(".main-photo-content", 1.4);
            })
        });
    }, 1000);
})();

(function controlModal() {
    const overlay = document.querySelector('[modal-overlay]')
    const buttonOpenModal = document.querySelector('[modal-open]')
    const buttonCloseModal = document.querySelector('[modal-close]')

    if (overlay || buttonOpenModal || buttonCloseModal) {
        buttonOpenModal.onclick = () => overlay.style.display = 'block'
        buttonCloseModal.onclick = () => overlay.style.display = 'none'
    }
})();

// Menu fixed
(function headerScrollFixed() {
    var header = document.querySelector('.header');
    var miniHeader = document.querySelector('.header__information');
    var headerBottom = document.querySelector('.header__bottom');
    document.addEventListener('scroll', function () {
        if (document.querySelector('body').clientHeight < 1200) {
            return
        }
        else {
            if (window.scrollY > 50) {
                header.classList.add('scroll-fixed');
                miniHeader.classList.add('hidden-bar');
                headerBottom.classList.add('header-colapse');
                document.querySelector('.main').style.marginTop = "160px"
            }
            else if (window.scrollY < 50) {
                header.classList.remove('scroll-fixed');
                miniHeader.classList.remove('hidden-bar');
                headerBottom.classList.remove('header-colapse');
                document.querySelector('.main').style.marginTop = "0"
            }
        }
    });
})();

// Submenu Mais Categorias
(function subMaisCategorias() {
    var subArrow = document.querySelectorAll('.click-drop');
    subArrow.forEach(element => {
        element.addEventListener('click', function () {
            this.nextSibling.classList.toggle('open')
        })
    });
})();

// Botão de Quantidade Produto
function createElementQtde() {
    setTimeout(function () {
        document.querySelector('.botao-continuar-comprando').addEventListener('click', function () {
            window.location.href = '/'
        })
    }, 1000)
    var qtdContent = document.querySelector('#product-form-box .color');

    qtdContent.innerHTML = "<span class='button-qtd plus-qtd'><i class='fas fa-chevron-up'></i></span>" + qtdContent.innerHTML + "<span class='button-qtd minus-qtd'><i class='fas fa-chevron-down'></i></span>";

    var qtdeButton = document.querySelectorAll('.button-qtd');
    var qtdeInput = document.querySelector('#product-form-box .color #quant');

    qtdeButton.forEach(qtde => {
        qtde.addEventListener('click', function () {
            if (this.classList.contains('plus-qtd')) {
                qtdeInput.value = parseInt(qtdeInput.value) + 1;
                qtdeInput.setAttribute('value', qtdeInput.value);
            }
            else {
                qtdeInput.value = qtdeInput.value - 1;
                if (qtdeInput.value <= 0) qtdeInput.value = 1;
                qtdeInput.setAttribute('value', qtdeInput.value);
            }
        })
    });

    // Btn cart redirect to home
    if (document.querySelector('.page-product')) {

        document.querySelector('.botao-comprar').addEventListener('click', function () {
            setTimeout(function () {
                document.querySelector('.botao-continuar-comprando').addEventListener('click', function () {
                    window.location.href = '/'
                })
            }, 2500)
        })
    }

}

(function qtdProd() {
    if (document.querySelector('html.page-product')) {
        setTimeout(createElementQtde(), 1000)
        document.querySelector('.botao-comprar').addEventListener('click', function(){
            setTimeout(createElementQtde(), 1000)
        })
        const firstTargetObject = document.querySelector('#product-form-box.passo3');
        const secondTargetObject = document.querySelector('#product-form-box.passo2');
        let observerFreteAssinante = new MutationObserver(createElementQtde);

        let config = {
            childList: true,
            attributes: true
        }

        if (firstTargetObject) {
            observerFreteAssinante.observe(firstTargetObject, config);
        }
        else if (secondTargetObject) {
            observerFreteAssinante.observe(secondTargetObject, config);
        }
    }
})();

// Carrinho de Compra
(function cartQtde() {
    setTimeout(function () {
        var dataSession = '/web_api/cart/' + document.querySelector('html').dataset.session
        var openCloseCart = document.querySelectorAll('.open-close');
        var contentCart = document.querySelector('.cart-resume ');
        var cartResume = document.querySelector('.cart-content');

        document.querySelector('.total-content .total').textContent != true ? document.querySelector('.total-content .total').textContent = 'R$ 00,00' : false

        openCloseCart.forEach(element => {
            element.addEventListener('click', function () {
                if (this.classList.contains('cart')) {
                    contentCart.classList.add('open')
                }
                else {
                    contentCart.classList.remove('open')
                }
            })
        });

        var cartItems = [];
        var finalPrice = 0;
        var finalQtde = 0;

        fetch(dataSession)
            .then(function (response) {
                if(response.ok) {
                    response.json().then(function (resp) {
                        resp.forEach(element => {
                            cartItems.push(
                                '<li class="item-resume-cart" data-price="' + element['Cart'].price * element['Cart'].quantity + '" data-qtde="' + element['Cart'].quantity + '">',
                                '<span onclick="deleteItemProduct(this)" class="delete-item" data-id="' + element['Cart'].product_id + ',' + element['Cart'].variant_id + '"><i class="far fa-trash-alt"></i></span>',
                                '<div class="infos-name">',
                                element['Cart'].product_name,
                                '<div class="flex-cart-info">',
                                '<span class="cart-info-price">',
                                'Preço: ' + '<strong class="price">' + new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(element['Cart'].price) + '</strong>',
                                '</span>',
                                '<span class="cart-info-qtde">',
                                'Quantidade: ' + '<strong class="qtde">' + element['Cart'].quantity + '</strong>',
                                '</span>',
                                '</div>',
                                '</div>',
                                '<img class="cart-image" src="' + element['Cart'].product_image['https'] + '">',
                                '</li>'
                            );
                            finalPrice = ((parseFloat(element['Cart'].price) * element['Cart'].quantity) + parseFloat(finalPrice)).toFixed(2);
                        });

                        cartResume.innerHTML = cartItems.join('');
                        document.querySelector('.total-content .total').textContent = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(finalPrice);
                        document.querySelector('.total-content .total').setAttribute('data-finalPrice', finalPrice);
                    });
                }
            });

    }, 500)
})()

// Deletar itens do carrinho
function deleteItemProduct(element) {
    var dataSession = document.querySelector('html').dataset.session;
    var prodId = element.dataset.id.split(',')[0];
    var variationId = element.dataset.id.split(',')[1];
    var dataPrice = element.closest('.item-resume-cart').dataset.price;
    var cartTotal = document.querySelector('.total-content .total').dataset.finalprice;
    var deleteURL = variationId != 0 ? '/web_api/carts/' + dataSession + '/' + prodId + '/' + variationId : '/web_api/carts/' + dataSession + '/' + prodId;

    cartTotal = cartTotal - dataPrice;

    document.querySelector('.total-content .total').dataset.finalprice = cartTotal.toFixed(2);
    document.querySelector('.total-content .total').textContent = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(cartTotal);

    const deleteHeader = {
        method: 'DELETE',
        contentType: "application/json; charset=utf-8",
    }

    fetch(deleteURL, deleteHeader)
        .then(function (response) {
            document.querySelector('.cart-amount span').textContent = document.querySelector('.cart-amount span').textContent - element.closest('.item-resume-cart').dataset.qtde;
            element.closest('.item-resume-cart').classList.add('remove-item');
            setTimeout(function(){
                element.closest('.item-resume-cart.remove-item').remove();
            }, 100)
        });
}